(function(){var t,n,r,e,i=[].slice,o=function(t,n){function r(){this.constructor=t}for(var e in n)c.call(n,e)&&(t[e]=n[e]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},c={}.hasOwnProperty;e=function(t){return t.replace(/"((?:\\\\|\\"|[^"])*)"/g,function(t,n){return n.replace(/,/g,"\x00")}).split(/\s*\,\s*/).map(function(t){return t.replace(/\0/g,",").replace(/\\(.)/,"$1")})},r=function(t){return t.map(function(t){return t.replace(/\\/,"\\\\").replace(/\]/,"\\]")}).map(function(t){return/[,"]/.test(t)?'"'+t.replace(/"/,'\\"')+'"':t}).join(",")},t=function(){function t(t){this.tokens=null!=t?t:[]}return t.fromObject=function(r){var e,i,o,c;for(c=[],e=0,i=r.length;i>e;e++)o=r[e],c.push(n.fromObject(o));return new t(c)},t.parse=function(n){var r,e,o,c,u;for(u=[];n.length;){for(c=null,o=t.tags,r=0,e=o.length;e>r&&(c=o[r],!c.re.test(n));r++);n=n.replace(c.re,function(t){return function(){var n,r,e,o;return r=3<=arguments.length?i.call(arguments,0,e=arguments.length-2):(e=0,[]),o=arguments[e++],n=arguments[e++],u.push(c.match.call(t,r)),""}}(this))}return new t(u)},t.prototype.toObject=function(){var t,n,r,e,i;for(r=this.tokens,e=[],t=0,n=r.length;n>t;t++)i=r[t],e.push(i.toObject());return e},t.prototype.toSakuraScript=function(){var t;return function(){var n,r,e,i;for(e=this.tokens,i=[],n=0,r=e.length;r>n;n++)t=e[n],i.push(t.toSakuraScript());return i}.call(this).join("")},t}(),n=function(){function t(){}return t.fromObject=function(n){var r,e,i,o,c;for(e=new t[n["class"]],c=Object.keys(n),r=0,o=c.length;o>r;r++)i=c[r],"class"!==i&&(e[i]=n[i]);return e},t.prototype.toObject=function(){var t,n,r,e,i,o;for(t=this.constructor.toString().slice(9).match(/^[^\s(]+/)[0],r={"class":t},o=Object.keys(this),n=0,i=o.length;i>n;n++)e=o[n],r[e]=this[e];return r},t.prototype.toSakuraScript=function(){throw new Error("not implemented")},t}(),n.Scope=function(t){function n(t,n){this.scope=t,this.view=n}return o(n,t),n.prototype.toSakuraScript=function(){switch(this.view){case"bracket":return"\\p["+this.scope+"]";case"nobracket":return"\\p"+this.scope;default:return"\\"+this.view}},n}(n),n.Surface=function(t){function n(t,n){this.surface=t,this.view=n}return o(n,t),n.prototype.toSakuraScript=function(){switch(this.view){case"bracket":return"\\s["+this.surface+"]";case"nobracket":return"\\s"+this.surface}},n}(n),n.SurfaceAlias=function(t){function n(t){this.surface_alias=t}return o(n,t),n.prototype.toSakuraScript=function(){return"\\s["+r([this.surface_alias])+"]"},n}(n),n.Balloon=function(t){function n(t,n){this.balloon=t,this.view=n}return o(n,t),n.prototype.toSakuraScript=function(){switch(this.view){case"bracket":return"\\b["+this.balloon+"]";case"nobracket":return"\\b"+this.balloon}},n}(n),n.PlayAnimation=function(t){function n(t,n){this.animation=t,this.view=n}return o(n,t),n.prototype.toSakuraScript=function(){switch(this.view){case"bracket":return"\\i["+this.animation+"]";case"nobracket":return"\\i"+this.animation}},n}(n),n.PlayAnimationWait=function(t){function n(t){this.animation=t}return o(n,t),n.prototype.toSakuraScript=function(){return"\\i["+this.animation+",wait]"},n}(n),n.SimpleWait=function(t){function n(t){this.period=t}return o(n,t),n.prototype.toSakuraScript=function(){return"\\w"+this.period},n}(n),n.PreciseWait=function(t){function n(t){this.period=t}return o(n,t),n.prototype.toSakuraScript=function(){return"\\_w["+this.period+"]"},n}(n),n.WaitFromBeginning=function(t){function n(t){this.period=t}return o(n,t),n.prototype.toSakuraScript=function(){return"\\__w["+this.period+"]"},n}(n),n.ResetBeginning=function(t){function n(){}return o(n,t),n.prototype.toSakuraScript=function(){return"\\__w[clear]"},n}(n),n.WaitAnimationEnd=function(t){function n(t){this.id=t}return o(n,t),n.prototype.toSakuraScript=function(){return"\\__w[animation,"+this.id+"]"},n}(n),n.ToggleQuick=function(t){function n(){}return o(n,t),n.prototype.toSakuraScript=function(){return"\\_q"},n}(n),n.ToggleSynchronize=function(t){function n(t){this.scopes=null!=t?t:[]}return o(n,t),n.prototype.toSakuraScript=function(){return"\\_s"+(this.scopes.length?"["+r(this.scopes)+"]":"")},n}(n),n.TimeCritical=function(t){function n(){}return o(n,t),n.prototype.toSakuraScript=function(){return"\\t"},n}(n),n.WaitClick=function(t){function n(t){this.noclear=null!=t?t:!1}return o(n,t),n.prototype.toSakuraScript=function(){return"\\x"},n}(n),n.NoChoiceTimeout=function(t){function n(){}return o(n,t),n.prototype.toSakuraScript=function(){return"\\*"},n}(n),n.EventChoice=function(t){function n(t,n,r){this.text=t,this.event=n,this.references=r}return o(n,t),n.prototype.toSakuraScript=function(){return"\\q["+r([this.text,this.event].concat(this.references))+"]"},n}(n),n.ReferencesChoice=function(t){function n(t,n){this.text=t,this.references=n}return o(n,t),n.prototype.toSakuraScript=function(){return"\\q["+r([this.text].concat(this.references))+"]"},n}(n),n.ScriptChoice=function(t){function n(t,n){this.text=t,this.script=n}return o(n,t),n.prototype.toSakuraScript=function(){return"\\q["+r([this.text,"script:"+this.script])+"]"},n}(n),n.OldReferenceChoice=function(t){function n(t,n,r){this.text=t,this.reference=n,this.view=r}return o(n,t),n.prototype.toSakuraScript=function(){return"\\q"+(this.view||"")+"["+r([this.reference])+"]["+r([this.text])+"]"},n}(n),n.BeginEventChoice=function(t){function n(t,n){this.event=t,this.references=n}return o(n,t),n.prototype.toSakuraScript=function(){return"\\__q["+r([this.event].concat(this.references))+"]"},n}(n),n.BeginReferencesChoice=function(t){function n(t){this.references=t}return o(n,t),n.prototype.toSakuraScript=function(){return"\\__q["+r(this.references)+"]"},n}(n),n.BeginScriptChoice=function(t){function n(t){this.script=t}return o(n,t),n.prototype.toSakuraScript=function(){return"\\__q["+r(["script:"+this.script])+"]"},n}(n),n.EndChoice=function(t){function n(){}return o(n,t),n.prototype.toSakuraScript=function(){return"\\__q"},n}(n),n.BeginEventAnchor=function(t){function n(t,n){this.event=t,this.references=n}return o(n,t),n.prototype.toSakuraScript=function(){return"\\_a["+r([this.event].concat(this.references))+"]"},n}(n),n.BeginReferencesAnchor=function(t){function n(t){this.references=t}return o(n,t),n.prototype.toSakuraScript=function(){return"\\_a["+r(this.references)+"]"},n}(n),n.BeginScriptAnchor=function(t){function n(t){this.script=t}return o(n,t),n.prototype.toSakuraScript=function(){return"\\_a["+r(["script:"+this.script])+"]"},n}(n),n.EndAnchor=function(t){function n(){}return o(n,t),n.prototype.toSakuraScript=function(){return"\\_a"},n}(n),n.LineBreak=function(t){function n(){}return o(n,t),n.prototype.toSakuraScript=function(){return"\\n"},n}(n),n.HalfLineBreak=function(t){function n(){}return o(n,t),n.prototype.toSakuraScript=function(){return"\\n[half]"},n}(n),n.PercentLineBreak=function(t){function n(t){this.percent=t}return o(n,t),n.prototype.toSakuraScript=function(){return"\\n["+this.percent+"]"},n}(n),n.ToggleNoAutoLineBreak=function(t){function n(){}return o(n,t),n.prototype.toSakuraScript=function(){return"\\_n"},n}(n),n.Location=function(t){function n(t,n){this.x=t,this.y=n}return o(n,t),n.prototype.toSakuraScript=function(){return"\\_l["+[this.x,this.y].join(",")+"]"},n}(n),n.Image=function(t){function n(t,n,r,e){this.path=t,this.x=n,this.y=r,this.args=e}return o(n,t),n.prototype.toSakuraScript=function(){return"\\_b["+[this.path,this.x,this.y].concat(this.args).join(",")+"]"},n}(n),n.InlineImage=function(t){function n(t,n,r,e){this.path=t,this.x=n,this.y=r,this.args=e}return o(n,t),n.prototype.toSakuraScript=function(){return"\\_b["+[this.path,"inline"].concat(this.args).join(",")+"]"},n}(n),n.Font=function(t){function n(t,n){this.name=t,this.args=n}return o(n,t),n.prototype.toSakuraScript=function(){return"\\f["+r([this.name].concat(this.args))+"]"},n}(n),n.BeFar=function(t){function n(){}return o(n,t),n.prototype.toSakuraScript=function(){return"\\4"},n}(n),n.BeNear=function(t){function n(){}return o(n,t),n.prototype.toSakuraScript=function(){return"\\5"},n}(n),n.Clear=function(t){function n(){}return o(n,t),n.prototype.toSakuraScript=function(){return"\\c"},n}(n),n.End=function(t){function n(){}return o(n,t),n.prototype.toSakuraScript=function(){return"\\e"},n}(n),n.OldChoiceEnd=function(t){function n(){}return o(n,t),n.prototype.toSakuraScript=function(){return"\\z"},n}(n),n.OpenCommunicateBox=function(t){function n(){}return o(n,t),n.prototype.toSakuraScript=function(){return"\\__c"},n}(n),n.OpenTeachBox=function(t){function n(){}return o(n,t),n.prototype.toSakuraScript=function(){return"\\__t"},n}(n),n.Halt=function(t){function n(){}return o(n,t),n.prototype.toSakuraScript=function(){return"\\-"},n}(n),n.Marker=function(t){function n(){}return o(n,t),n.prototype.toSakuraScript=function(){return"\\![*]"},n}(n),n.Char=function(t){function n(t){this.raw_char=t,this.raw_char&&(this["char"]=this.raw_char.replace(/</,"&lt;").replace(/>/,"&gt;").replace(/&/,"&amp;"))}return o(n,t),n.prototype.toSakuraScript=function(){return this.raw_char},n}(n),n.EscapeChar=function(t){function n(){this["char"]="\\"}return o(n,t),n.prototype.toSakuraScript=function(){return"\\\\"},n}(n.Char),n.UCSChar=function(t){function n(t){this.code_point=t,this["char"]="&#"+this.code_point+";"}return o(n,t),n.prototype.toSakuraScript=function(){return"\\_u[0x"+this.code_point.toString(16)+"]"},n}(n.Char),n.AsciiChar=function(t){function n(t){this.code_point=t,this["char"]="&#"+this.code_point+";"}return o(n,t),n.prototype.toSakuraScript=function(){return"\\_m[0x"+this.code_point.toString(16)+"]"},n}(n.Char),n.EntityChar=function(t){function n(t){this.entity=t,this["char"]="&"+this.entity+";"}return o(n,t),n.prototype.toSakuraScript=function(){return"\\&["+this.entity+"]"},n}(n.Char),n.Animation=function(t){function n(t,n,r){this.command=t,this.id=n,this.args=r}return o(n,t),n.prototype.toSakuraScript=function(){return"\\![anim,"+r([this.command,this.id].concat(this.args))+"]"},n}(n),n.Bind=function(t){function n(t,n,r){this.category=t,this.parts=n,this.dress_up=r}return o(n,t),n.prototype.toSakuraScript=function(){return"\\![bind,"+r([this.category,this.parts].concat(null!=this.dress_up?[Number(this.dress_up)]:[]))+"]"},n}(n),n.LockRepaint=function(t){function n(){}return o(n,t),n.prototype.toSakuraScript=function(){return"\\![lock,repaint]"},n}(n),n.UnlockRepaint=function(t){function n(){}return o(n,t),n.prototype.toSakuraScript=function(){return"\\![unlock,repaint]"},n}(n),n.Move=function(t){function n(t,n,r,e,i,o){this.x=t,this.y=n,this.duration=r,this.origin_type=e,this.source_origin=i,this.target_origin=o}return o(n,t),n.prototype.toSakuraScript=function(){return"\\![move,"+r([this.x,this.y,this.duration,this.origin_type,this.source_origin,this.target_origin])+"]"},n}(n),n.MoveAsync=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return o(n,t),n.prototype.toSakuraScript=function(){return"\\![moveasync,"+r([this.x,this.y,this.duration,this.origin_type,this.source_origin,this.target_origin])+"]"},n}(n.Move),n.MoveAsyncCancel=function(t){function n(){}return o(n,t),n.prototype.toSakuraScript=function(){return"\\![moveasync,cancel]"},n}(n.Move),n.Raise=function(t){function n(t,n){this.event=t,this.references=n}return o(n,t),n.prototype.toSakuraScript=function(){return"\\![raise,"+r([this.event].concat(this.references))+"]"},n}(n),n.TimerRaise=function(t){function n(t,n){this.event=t,this.references=n}return o(n,t),n.prototype.toSakuraScript=function(){return"\\![timerraise,"+r([this.event].concat(this.references))+"]"},n}(n),n.Notify=function(t){function n(t,n){this.event=t,this.references=n}return o(n,t),n.prototype.toSakuraScript=function(){return"\\![notify,"+r([this.event].concat(this.references))+"]"},n}(n),n.Set=function(t){function n(t,n){this.id=t,this.args=n}return o(n,t),n.prototype.toSakuraScript=function(){return"\\![set,"+r([this.id].concat(this.args))+"]"},n}(n),n.Open=function(t){function n(t,n){this.command=t,this.args=n}return o(n,t),n.prototype.toSakuraScript=function(){return"\\![open,"+r([this.command].concat(this.args))+"]"},n}(n),n.Close=function(t){function n(t,n){this.command=t,this.args=n}return o(n,t),n.prototype.toSakuraScript=function(){return"\\![close,"+r([this.command].concat(this.args))+"]"},n}(n),n.NotImplemented=function(t){function n(t){this.str=t}return o(n,t),n.prototype.toSakuraScript=function(){return this.str},n}(n),t.tags=[{re:/^\\([h0])/,match:function(t){return new n.Scope(0,t[1])}},{re:/^\\([u1])/,match:function(t){return new n.Scope(1,t[1])}},{re:/^\\p\[(\d+)\]/,match:function(t){return new n.Scope(Number(t[1]),"bracket")}},{re:/^\\p(\d)/,match:function(t){return new n.Scope(Number(t[1]),"nobracket")}},{re:/^\\s(\d)/,match:function(t){return new n.Surface(Number(t[1]),"nobracket")}},{re:/^\\s\[([^\]]+)\]/,match:function(t){return isNaN(t[1])?new n.SurfaceAlias(t[1]):new n.Surface(Number(t[1]),"bracket")}},{re:/^\\b(\d)/,match:function(t){return new n.Balloon(Number(t[1]),"nobracket")}},{re:/^\\b\[([^\]]+)\]/,match:function(t){return new n.Balloon(Number(t[1]),"bracket")}},{re:/^\\i(\d)/,match:function(t){return new n.PlayAnimation(Number(t[1]),"nobracket")}},{re:/^\\i\[(\d+)\]/,match:function(t){return new n.PlayAnimation(Number(t[1]),"bracket")}},{re:/^\\i\[(\d+),wait\]/,match:function(t){return new n.PlayAnimationWait(Number(t[1]))}},{re:/^\\w(\d)/,match:function(t){return new n.SimpleWait(Number(t[1]))}},{re:/^\\_w\[(\d+)\]/,match:function(t){return new n.PreciseWait(Number(t[1]))}},{re:/^\\__w\[animation,(\d+)\]/,match:function(t){return new n.WaitAnimationEnd(Number(t[1]))}},{re:/^\\__w\[clear\]/,match:function(t){return new n.ResetBeginning}},{re:/^\\__w\[(\d+)\]/,match:function(t){return new n.WaitFromBeginning(Number(t[1]))}},{re:/^\\_q/,match:function(t){return new n.ToggleQuick}},{re:/^\\_s\[([^\]]+)\]/,match:function(t){return new n.ToggleSynchronize(e(t[1]).map(function(t){return Number(t)}))}},{re:/^\\_s/,match:function(t){return new n.ToggleSynchronize}},{re:/^\\t/,match:function(t){return new n.TimeCritical}},{re:/^\\x(\[noclear\])?/,match:function(t){return new n.WaitClick(!!t[1])}},{re:/^\\\*/,match:function(t){return new n.NoChoiceTimeout}},{re:/^\\q\[((?:\\\\|\\\]|[^\]])+)\]/,match:function(t){var r;return r=e(t[1]),/^On/.test(r[1])?new n.EventChoice(r[0],r[1],r.slice(2)):/^script:/.test(r[1])?new n.ScriptChoice(r[0],r[1].replace(/^script:/,"")):new n.ReferencesChoice(r[0],r.slice(1))}},{re:/^\\__q\[((?:\\\\|\\\]|[^\]])+)\]/,match:function(t){var r;return r=e(t[1]),/^On/.test(r[0])?new n.BeginEventChoice(r[0],r.slice(1)):/^script:/.test(r[0])?new n.BeginScriptChoice(r[0].replace(/^script:/,"")):new n.BeginReferencesChoice(r)}},{re:/^\\__q/,match:function(t){return new n.EndChoice}},{re:/^\\q(\d*)\[((?:\\\\|\\\]|[^\]])+)\]\[((?:\\\\|\\\]|[^\]])+)\]/,match:function(t){return new n.OldReferenceChoice(t[3],t[2],t[1])}},{re:/^\\_a\[((?:\\\\|\\\]|[^\]])+)\]/,match:function(t){var r;return r=e(t[1]),/^On/.test(r[0])?new n.BeginEventAnchor(r[0],r.slice(1)):/^script:/.test(r[0])?new n.BeginScriptAnchor(r[0].replace(/^script:/,"")):new n.BeginReferencesAnchor(r)}},{re:/^\\_a/,match:function(t){return new n.EndAnchor}},{re:/^\\n\[half\]/,match:function(t){return new n.HalfLineBreak}},{re:/^\\n\[(\d+)\]/,match:function(t){return new n.PercentLineBreak(Number(t[1]))}},{re:/^\\n/,match:function(t){return new n.LineBreak}},{re:/^\\_n/,match:function(t){return new n.ToggleNoAutoLineBreak}},{re:/^\\_l\[([^\]]+)\]/,match:function(t){var r,i,o;return r=e(t[1]),i=r[0],o=r[1],new n.Location(i,o)}},{re:/^\\_b\[((?:\\\\|\\\]|[^\]])+)\]/,match:function(t){var r;return r=e(t[1]),"inline"===r[1]?new n.InlineImage(r[0],r.slice(2)):new n.Image(r[0],r[1],r[2],r.slice(3))}},{re:/^\\f\[([^\]]+)\]/,match:function(t){var r;return r=e(t[1]),new n.Font(r[0],r.slice(1))}},{re:/^\\4/,match:function(t){return new n.BeFar}},{re:/^\\5/,match:function(t){return new n.BeNear}},{re:/^\\c/,match:function(t){return new n.Clear}},{re:/^\\e/,match:function(t){return new n.End}},{re:/^\\z/,match:function(t){return new n.OldChoiceEnd}},{re:/^\\-/,match:function(t){return new n.Halt}},{re:/^\\\\/,match:function(t){return new n.EscapeChar}},{re:/^\\!\[anim,((?:\\\\|\\\]|[^\]])+)\]/,match:function(t){var r;return r=e(t[1]),new n.Animation(r[0],r[1],r.slice(2))}},{re:/^\\!\[bind,((?:\\\\|\\\]|[^\]])+)\]/,match:function(t){var r;return r=e(t[1]),new n.Bind(r[0],r[1],null!=r[2]?1===Number(r[2]):null)}},{re:/^\\!\[moveasync,cancel\]/,match:function(t){return new n.MoveAsyncCancel}},{re:/^\\!\[move(async)?,((?:\\\\|\\\]|[^\]])+)\]/,match:function(t){var r,i;return i=t[1]?n.MoveAsync:n.Move,r=e(t[2]),new i(r[0],r[1],r[2],r[3],r[4],r[5])}},{re:/^\\!\[lock,repaint\]/,match:function(t){return new n.LockRepaint}},{re:/^\\!\[unlock,repaint\]/,match:function(t){return new n.UnlockRepaint}},{re:/^\\!\[set,((?:\\\\|\\\]|[^\]])+)\]/,match:function(t){var r;return r=e(t[1]),new n.Set(r[0],r.slice(1))}},{re:/^\\!\[open,((?:\\\\|\\\]|[^\]])+)\]/,match:function(t){var r;return r=e(t[1]),new n.Open(r[0],r.slice(1))}},{re:/^\\!\[close,((?:\\\\|\\\]|[^\]])+)\]/,match:function(t){var r;return r=e(t[1]),new n.Close(r[0],r.slice(1))}},{re:/^\\__c/,match:function(t){return new n.OpenCommunicateBox}},{re:/^\\__t/,match:function(t){return new n.OpenTeachBox}},{re:/^\\!\[\s*raise\s*,\s*((?:\\\\|\\\]|[^\]])+)\]/,match:function(t){var r;return r=e(t[1]),new n.Raise(r[0],r.slice(1))}},{re:/^\\!\[\s*timerraise\s*,\s*((?:\\\\|\\\]|[^\]])+)\]/,match:function(t){var r;return r=e(t[1]),new n.TimerRaise(r[0],r.slice(1))}},{re:/^\\!\[\s*notify\s*,\s*((?:\\\\|\\\]|[^\]])+)\]/,match:function(t){var r;return r=e(t[1]),new n.Notify(r[0],r.slice(1))}},{re:/^\\!\[\*\]/,match:function(t){return new n.Marker}},{re:/^\\_u\[([A-Fa-fXx0-9]+)\]/,match:function(t){return new n.UCSChar(Number(t[1]))}},{re:/^\\_m\[([A-Fa-fXx0-9]+)\]/,match:function(t){return new n.AsciiChar(Number(t[1]))}},{re:/^\\&\[([A-Za-z0-9]+)\]/,match:function(t){return new n.EntityChar(t[1])}},{re:/^\\[C67+v8]/,match:function(t){return new n.NotImplemented(t[0])}},{re:/^\\_[+V]/,match:function(t){return new n.NotImplemented(t[0])}},{re:/^\\[8j]\[.*?\]/,match:function(t){return new n.NotImplemented(t[0])}},{re:/^\\_[!?v]\[.*?\]/,match:function(t){return new n.NotImplemented(t[0])}},{re:/^\\!\[.*?\]/,match:function(t){return new n.NotImplemented(t[0])}},{re:/^./,match:function(t){return new n.Char(t[0])}}],null!=("undefined"!=typeof module&&null!==module?module.exports:void 0)?module.exports={SakuraScript:t,SakuraScriptToken:n}:(this.SakuraScript=t,this.SakuraScriptToken=n)}).call(this);
//# sourceMappingURL=sakurascript.min.js.map
